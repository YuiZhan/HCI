import React, { useState, useEffect } from 'react';
import { Sparkles, Zap, CloudRain, Terminal, RefreshCw } from 'lucide-react';

export default function MemeBotLab() {
  const [mood, setMood] = useState('neutral');
  const [speech, setSpeech] = useState('系統待機中... 請輸入情緒指令。');
  const [isGlitching, setIsGlitching] = useState(false);
  const [floatY, setFloatY] = useState(0);

  // 呼吸動畫效果
  useEffect(() => {
    const interval = setInterval(() => {
      setFloatY((prev) => (prev === 0 ? -10 : 0));
    }, 2000);
    return () => clearInterval(interval);
  }, []);

  const memeDatabase = {
    joy: [
      "好耶！這才是人生嘛！ (≧∇≦)/",
      "笑死，這 code 居然能跑！",
      "今天的心情比剛出爐的薯條還脆。",
      "快樂指數溢出，請檢查 Int32 上限。",
      "我看你是懂幽默的喔！"
    ],
    anger: [
      "哼，試試？(╬ Ò ‸ Ó)",
      "警告：耐心值已低於 5%。",
      "我看你是欠電了是吧？",
      "CPU 溫度飆升中，別惹我。",
      "這就是你對待人工智慧的態度嗎？"
    ],
    sadness: [
      "嗚嗚... 我只是一塊沒有靈魂的木頭...",
      "藍瘦，香菇... (´;ω;`)",
      "感覺像是被無限迴圈困住了。",
      "系統偵測到大量洋蔥。",
      "別管我，我去角落長香菇了。"
    ],
    neutral: [
      "系統待機中... 啵。",
      "人類，渴望一些情緒輸入嗎？",
      "正在分析你的微表情...",
      "保持冷靜，繼續 Coding。"
    ]
  };

  const handleMoodChange = (newMood) => {
    if (isGlitching) return;
    
    // 觸發故障效果
    setIsGlitching(true);
    
    setTimeout(() => {
      setMood(newMood);
      const quotes = memeDatabase[newMood];
      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      setSpeech(randomQuote);
      setIsGlitching(false);
    }, 300); // 300ms 雜訊時間
  };

  // 機器人組件 (CSS Art)
  const Robot = () => (
    <div 
      className="relative flex flex-col items-center justify-center transition-transform duration-[2000ms] ease-in-out"
      style={{ transform: `translateY(${floatY}px)` }}
    >
      {/* 天線 */}
      <div className="w-1 h-8 bg-stone-400 mb-[-5px] relative z-0">
        <div className={`absolute -top-2 -left-1.5 w-4 h-4 rounded-full ${mood === 'anger' ? 'bg-red-500 animate-pulse' : 'bg-green-400'} shadow-[0_0_10px_rgba(74,222,128,0.5)]`}></div>
      </div>

      {/* 頭部 (木質) */}
      <div className="relative z-10 w-48 h-40 bg-[#8B5E3C] rounded-2xl border-b-8 border-r-8 border-[#5D3A22] shadow-2xl flex items-center justify-center overflow-hidden">
        {/* 木紋細節 */}
        <div className="absolute top-2 left-4 w-40 h-1 bg-[#A06F48] opacity-30 rounded-full"></div>
        <div className="absolute bottom-4 right-4 w-20 h-1 bg-[#A06F48] opacity-30 rounded-full"></div>

        {/* 臉部螢幕 (CRT 風格) */}
        <div className={`w-36 h-24 bg-black rounded-lg relative flex items-center justify-center gap-6 overflow-hidden border-2 border-[#333] shadow-[inset_0_0_20px_rgba(0,0,0,1)] ${isGlitching ? 'animate-pulse' : ''}`}>
          
          {/* 螢幕掃描線 */}
          <div className="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-20 bg-[length:100%_2px,3px_100%] pointer-events-none"></div>

          {/* 眼睛渲染邏輯 */}
          {!isGlitching && (
            <>
              {mood === 'joy' && (
                <>
                  <div className="w-8 h-4 border-t-4 border-cyan-400 rounded-t-full shadow-[0_0_10px_#22d3ee]"></div>
                  <div className="w-8 h-4 border-t-4 border-cyan-400 rounded-t-full shadow-[0_0_10px_#22d3ee]"></div>
                </>
              )}
              {mood === 'anger' && (
                <>
                  <div className="w-8 h-2 bg-red-500 rotate-12 shadow-[0_0_10px_#ef4444]"></div>
                  <div className="w-8 h-2 bg-red-500 -rotate-12 shadow-[0_0_10px_#ef4444]"></div>
                </>
              )}
              {mood === 'sadness' && (
                <>
                  <div className="w-8 h-2 bg-blue-500 -rotate-12 mt-2 shadow-[0_0_10px_#3b82f6]"></div>
                  <div className="w-8 h-2 bg-blue-500 rotate-12 mt-2 shadow-[0_0_10px_#3b82f6]"></div>
                </>
              )}
              {mood === 'neutral' && (
                <>
                  <div className="w-4 h-4 bg-green-400 rounded-full animate-blink shadow-[0_0_10px_#4ade80]"></div>
                  <div className="w-4 h-4 bg-green-400 rounded-full animate-blink shadow-[0_0_10px_#4ade80]"></div>
                </>
              )}
            </>
          )}

          {/* 故障雜訊塊 */}
          {isGlitching && (
            <div className="absolute inset-0 bg-white/10 flex items-center justify-center">
              <span className="font-mono text-xs text-green-500">LOADING...</span>
            </div>
          )}
        </div>
      </div>

      {/* 身體 (木質) */}
      <div className="w-32 h-24 bg-[#8B5E3C] -mt-2 rounded-b-3xl border-b-8 border-r-8 border-[#5D3A22] shadow-xl relative flex flex-col items-center pt-4">
        {/* 胸口面板 */}
        <div className="w-20 h-12 bg-[#4A3728] rounded border border-[#6B4E3A] flex items-center justify-center gap-2">
          <div className={`w-2 h-2 rounded-full ${mood === 'joy' ? 'bg-yellow-400 animate-bounce' : 'bg-gray-600'}`}></div>
          <div className={`w-2 h-2 rounded-full ${mood === 'anger' ? 'bg-red-500 animate-pulse' : 'bg-gray-600'}`}></div>
          <div className={`w-2 h-2 rounded-full ${mood === 'sadness' ? 'bg-blue-500 animate-bounce' : 'bg-gray-600'}`}></div>
        </div>
      </div>
      
      {/* 影子 */}
      <div className="w-40 h-4 bg-black/20 rounded-[100%] mt-8 blur-md transition-all duration-[2000ms]" 
           style={{ transform: `scale(${floatY === 0 ? 1 : 0.8})` }}></div>
    </div>
  );

  return (
    <div className="min-h-screen bg-[#EBE9E4] text-[#2D2D2D] font-mono flex items-center justify-center p-4 selection:bg-amber-200">
      
      {/* 背景裝飾 */}
      <div className="fixed inset-0 pointer-events-none opacity-5" 
           style={{ backgroundImage: 'radial-gradient(#444 1px, transparent 1px)', backgroundSize: '24px 24px' }}>
      </div>

      <div className="max-w-md w-full relative z-10">
        
        {/* 標題區 */}
        <div className="mb-8 text-center">
          <div className="inline-flex items-center gap-2 border-2 border-black px-4 py-1 rounded-full bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <Terminal size={16} />
            <h1 className="text-lg font-bold tracking-tighter">MEME-BOT 表情實驗室 v1.0</h1>
          </div>
        </div>

        {/* 機器人展示區 */}
        <div className="bg-white/50 backdrop-blur-sm border-2 border-black rounded-3xl p-8 mb-6 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.1)] relative overflow-hidden">
          {/* 對話氣泡 */}
          <div className="absolute top-4 left-0 right-0 px-4 flex justify-center z-20">
            <div className={`
              bg-white border-2 border-black rounded-2xl px-6 py-4 max-w-[280px] text-center shadow-lg
              transition-all duration-300 transform origin-bottom
              ${isGlitching ? 'scale-95 opacity-80' : 'scale-100 opacity-100'}
            `}>
              <p className={`text-sm md:text-base font-bold leading-relaxed ${
                mood === 'anger' ? 'text-red-600' : 
                mood === 'sadness' ? 'text-blue-600' : 'text-black'
              }`}>
                "{speech}"
              </p>
              {/* 氣泡尾巴 */}
              <div className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-b-2 border-r-2 border-black rotate-45"></div>
            </div>
          </div>

          <div className="mt-16 mb-4">
            <Robot />
          </div>
        </div>

        {/* 控制面板 */}
        <div className="grid grid-cols-3 gap-4">
          <button
            onClick={() => handleMoodChange('joy')}
            className="group relative bg-[#FFD93D] border-2 border-black rounded-xl p-4 flex flex-col items-center gap-2 hover:-translate-y-1 hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:translate-y-0 active:shadow-none transition-all"
          >
            <Sparkles className="w-6 h-6 text-black group-hover:scale-110 transition-transform" />
            <span className="text-xs font-bold tracking-widest">JOY</span>
          </button>

          <button
            onClick={() => handleMoodChange('anger')}
            className="group relative bg-[#FF6B6B] border-2 border-black rounded-xl p-4 flex flex-col items-center gap-2 hover:-translate-y-1 hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:translate-y-0 active:shadow-none transition-all"
          >
            <Zap className="w-6 h-6 text-black group-hover:scale-110 transition-transform" />
            <span className="text-xs font-bold tracking-widest">ANGER</span>
          </button>

          <button
            onClick={() => handleMoodChange('sadness')}
            className="group relative bg-[#4D96FF] border-2 border-black rounded-xl p-4 flex flex-col items-center gap-2 hover:-translate-y-1 hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:translate-y-0 active:shadow-none transition-all"
          >
            <CloudRain className="w-6 h-6 text-black group-hover:scale-110 transition-transform" />
            <span className="text-xs font-bold tracking-widest">SAD</span>
          </button>
        </div>

        {/* 重置按鈕 */}
        <div className="mt-6 flex justify-center">
          <button 
            onClick={() => handleMoodChange('neutral')}
            className="flex items-center gap-2 text-gray-500 hover:text-black transition-colors text-xs font-mono uppercase tracking-widest"
          >
            <RefreshCw size={12} />
            System Reset
          </button>
        </div>

      </div>

      <style>{`
        @keyframes blink {
          0%, 90%, 100% { transform: scaleY(1); }
          95% { transform: scaleY(0.1); }
        }
        .animate-blink {
          animation: blink 4s infinite;
        }
      `}</style>
    </div>
  );
}