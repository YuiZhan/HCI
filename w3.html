import React, { useState, useEffect } from 'react';
import { Clock, Sun, Moon, Coffee, AlertCircle, Heart, DollarSign, Zap, ChevronRight } from 'lucide-react';

const ObservationTimeline = () => {
  // 初始狀態設為第一個時間點
  const [activeId, setActiveId] = useState(1);
  const [animate, setAnimate] = useState(false);

  // 資料數據：林煜博的觀察筆記
  const timelineData = [
    {
      id: 1,
      period: "早晨",
      time: "08:25 AM",
      icon: <Clock className="w-6 h-6" />,
      title: "趕時間的焦慮",
      moodType: "anxious", // 用於決定背景色系 (冷色)
      moodColor: "bg-slate-800",
      textColor: "text-slate-100",
      accentColor: "text-cyan-400",
      heartRate: "110 bpm",
      observation: "觀察對象在捷運站內進行無氧衝刺。左手緊握手機，右手提著早餐，神情慌張。對捷運關門警示音表現出極度敏感反應。",
      conclusion: "對遲到的恐懼引發了腎上腺素激增，典型的通勤焦慮症狀。"
    },
    {
      id: 2,
      period: "中午",
      time: "12:30 PM",
      icon: <Coffee className="w-6 h-6" />,
      title: "午休的放空",
      moodType: "calm", // 中性/放鬆
      moodColor: "bg-emerald-900",
      textColor: "text-emerald-50",
      accentColor: "text-emerald-300",
      heartRate: "75 bpm",
      observation: "攝取碳水化合物後，觀察對象眼神逐漸失焦，呈現一種名為「飯氣攻心」的生理狀態。暫時切斷了與工作的連結。",
      conclusion: "短暫的腦波平緩期，為下午的戰鬥積蓄能量。"
    },
    {
      id: 3,
      period: "下午",
      time: "15:45 PM",
      icon: <DollarSign className="w-6 h-6" />,
      title: "入帳的狂喜",
      moodType: "happy", // 暖色/開心
      moodColor: "bg-orange-500",
      textColor: "text-white",
      accentColor: "text-yellow-200",
      heartRate: "95 bpm (興奮)",
      observation: "手機發出「薪資入帳」通知音效。觀察對象嘴角上揚角度超過 45 度，在此刻開啟了購物網站視窗。",
      conclusion: "金錢刺激帶來的多巴胺分泌顯著，工作痛苦指數瞬間歸零。"
    },
    {
      id: 4,
      period: "晚上",
      time: "20:00 PM",
      icon: <Moon className="w-6 h-6" />,
      title: "下班的微醺",
      moodType: "chill", // 暖/暗色
      moodColor: "bg-indigo-950",
      textColor: "text-indigo-100",
      accentColor: "text-pink-400",
      heartRate: "68 bpm",
      observation: "卸下社會化面具，呈現液態化癱軟在沙發上。手中握有酒精或高熱量食物，正在觀看無腦影片。",
      conclusion: "回歸生物本能的休息狀態，修復白天的社交損耗。"
    }
  ];

  // 取得當前選中的資料
  const currentData = timelineData.find(item => item.id === activeId);

  // 切換時觸發動畫效果
  useEffect(() => {
    setAnimate(true);
    const timer = setTimeout(() => setAnimate(false), 500);
    return () => clearTimeout(timer);
  }, [activeId]);

  return (
    <div className={`min-h-screen w-full transition-colors duration-1000 ease-in-out flex flex-col items-center justify-center p-4 ${currentData.moodColor} ${currentData.textColor}`}>
      
      {/* 標題區 */}
      <header className="mb-10 text-center animate-fade-in">
        <div className="inline-flex items-center gap-2 px-4 py-1 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 mb-4">
          <Zap className="w-4 h-4" />
          <span className="text-sm font-light tracking-widest">HUMAN OBSERVATION LOG</span>
        </div>
        <h1 className="text-4xl md:text-5xl font-bold tracking-wider mb-2">林煜博觀察筆記</h1>
        <p className="opacity-80 text-lg">對象編號：USER-001 情緒波動紀錄</p>
      </header>

      <div className="flex flex-col md:flex-row gap-12 max-w-6xl w-full items-center justify-center">
        
        {/* 左側：互動時間軸 */}
        <div className="relative flex flex-row md:flex-col justify-between md:h-[400px] w-full md:w-auto px-4 md:px-0 gap-4 md:gap-0">
          {/* 連接線 (背景) */}
          <div className="absolute left-0 right-0 top-1/2 h-1 md:h-full md:w-1 md:left-1/2 md:top-0 bg-white/20 -z-0 transform -translate-y-1/2 md:translate-y-0 md:-translate-x-1/2"></div>
          
          {timelineData.map((item) => (
            <button
              key={item.id}
              onClick={() => setActiveId(item.id)}
              className={`relative group z-10 flex flex-col md:flex-row items-center gap-4 transition-all duration-300 ${activeId === item.id ? 'scale-110' : 'hover:scale-105 opacity-70 hover:opacity-100'}`}
            >
              {/* 時間標籤 (桌機版顯示在左側，手機版隱藏) */}
              <span className={`hidden md:block w-24 text-right font-mono text-sm transition-all duration-300 ${activeId === item.id ? 'font-bold opacity-100' : 'opacity-60'}`}>
                {item.time}
              </span>

              {/* 節點圓圈 */}
              <div className={`
                w-12 h-12 md:w-14 md:h-14 rounded-full flex items-center justify-center shadow-lg border-4 transition-all duration-500
                ${activeId === item.id 
                  ? 'bg-white text-gray-900 border-white rotate-0' 
                  : 'bg-black/30 border-white/30 text-white rotate-12'}
              `}>
                {item.icon}
              </div>

              {/* 手機版時間標籤 */}
              <span className="md:hidden text-xs font-mono mt-2">{item.period}</span>
              
              {/* 文字標籤 (桌機版顯示在右側，手機版隱藏) */}
              <span className={`hidden md:block w-24 text-left font-bold text-lg transition-all duration-300 ${activeId === item.id ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-4'}`}>
                {item.period}
              </span>
            </button>
          ))}
        </div>

        {/* 右側：觀察卡片顯示區 */}
        <div className="w-full md:w-[500px] perspective-1000">
          <div 
            className={`
              relative bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-8 shadow-2xl
              transform transition-all duration-700 ease-out
              ${animate ? 'opacity-0 translate-y-8 rotate-x-12' : 'opacity-100 translate-y-0 rotate-x-0'}
            `}
          >
            {/* 卡片標頭 */}
            <div className="flex justify-between items-start mb-6 border-b border-white/10 pb-4">
              <div>
                <h2 className="text-3xl font-bold mb-1 flex items-center gap-2">
                  {currentData.title}
                </h2>
                <span className={`text-sm font-mono px-2 py-0.5 rounded ${currentData.moodType === 'anxious' ? 'bg-red-500/20 text-red-200' : 'bg-green-500/20 text-green-200'}`}>
                  MOOD: {currentData.moodType.toUpperCase()}
                </span>
              </div>
              <div className="text-right">
                <div className={`text-2xl font-black font-mono ${currentData.accentColor}`}>
                  {currentData.heartRate}
                </div>
                <div className="text-xs opacity-60">HEART RATE</div>
              </div>
            </div>

            {/* 觀察內容 */}
            <div className="space-y-6">
              <div className="space-y-2">
                <h3 className="text-sm font-bold opacity-50 uppercase tracking-wider flex items-center gap-2">
                  <AlertCircle className="w-4 h-4" /> 現場觀察紀錄
                </h3>
                <p className="text-lg leading-relaxed font-serif italic">
                  "{currentData.observation}"
                </p>
              </div>

              <div className="bg-black/20 p-4 rounded-lg border-l-4 border-current">
                <h3 className="text-xs font-bold opacity-70 uppercase tracking-wider mb-1 flex items-center gap-2">
                  <ChevronRight className="w-3 h-3" /> 林煜博的結論
                </h3>
                <p className="font-medium">
                  {currentData.conclusion}
                </p>
              </div>
            </div>

            {/* 裝飾性背景元素 */}
            <div className={`absolute -top-10 -right-10 w-32 h-32 rounded-full blur-3xl opacity-30 ${currentData.moodType === 'anxious' ? 'bg-cyan-500' : 'bg-yellow-500'}`}></div>
            <div className={`absolute -bottom-10 -left-10 w-40 h-40 rounded-full blur-3xl opacity-20 ${currentData.moodType === 'anxious' ? 'bg-blue-600' : 'bg-red-500'}`}></div>
          </div>
        </div>
      </div>

      {/* 底部提示 */}
      <div className="fixed bottom-4 text-xs opacity-40 font-mono">
        CLICK TIMELINE NODES TO SYNC DATA
      </div>
    </div>
  );
};

export default ObservationTimeline;