<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üáπüáº Âè∞ÁÅ£ÁæéÈ£üÁÜ±ÊÉÖÈòøÂß®Áà≠Èú∏Êà∞ üáπüáº</title>
    <!-- ÂºïÂÖ• Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #feca57;
            --bg-color: #ffeaa7;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Agent Section --- */
        #agent-container {
            position: absolute;
            top: 5%;
            width: 90%;
            max-width: 600px;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }

        .agent-avatar {
            font-size: 4rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
            animation: float 3s ease-in-out infinite;
        }

        .agent-bubble {
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            border: 4px solid var(--primary-color);
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            margin-top: 10px;
            position: relative;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: inline-block;
        }

        .agent-bubble.pop {
            transform: scale(1.05);
        }

        .agent-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: transparent transparent var(--primary-color);
        }

        /* --- Battle Arena --- */
        #arena {
            display: flex;
            width: 100%;
            height: 60%;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        .food-card {
            flex: 1;
            max-width: 400px;
            height: 100%;
            background: white;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            overflow: hidden;
            user-select: none;
        }

        /* Image Wrapper & Fallback */
        .food-image-wrapper {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            z-index: 2;
            transition: transform 0.2s;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .food-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .emoji-fallback {
            font-size: 5rem;
            line-height: 1;
            display: none; /* Hidden by default */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .emoji-fallback.big {
            font-size: 8rem;
        }

        .food-name {
            font-size: 1.5rem;
            font-weight: 900;
            margin-top: 25px;
            z-index: 2;
            text-align: center;
        }

        @media (min-width: 768px) {
            .food-image-wrapper { width: 220px; height: 220px; }
            .food-name { font-size: 2rem; }
            .emoji-fallback { font-size: 7rem; }
        }

        .card-bg-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, var(--secondary-color) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        /* Hover Effects */
        @media (hover: hover) {
            .food-card:hover {
                transform: scale(1.05);
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            }
            .food-card:hover .food-image-wrapper {
                animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; 
            }
            .food-card:hover .card-bg-effect {
                opacity: 0.5;
            }
        }

        /* Animations */
        .winner-anim {
            animation: zoomAndGlow 0.8s forwards !important;
            z-index: 10;
        }

        .loser-anim {
            animation: explodeAndFade 0.8s forwards !important;
            pointer-events: none;
        }

        /* --- Progress --- */
        #progress-container {
            position: absolute;
            bottom: 5%;
            width: 80%;
            text-align: center;
        }

        #round-info {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #636e72;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .dot {
            width: 10px;
            height: 10px;
            background-color: #dfe6e9;
            border-radius: 50%;
        }

        .dot.active {
            background-color: var(--primary-color);
        }

        /* --- Champion Screen --- */
        #champion-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: popIn 0.5s ease-out;
            text-align: center;
            width: 100%;
        }

        .champion-title {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 0;
        }

        .champion-image-wrapper {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            overflow: hidden;
            border: 8px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 30px 0;
            animation: spin 20s linear infinite; /* Slower spin for photo */
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        #champion-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .champion-name {
            font-size: 2rem;
            margin-bottom: 30px;
        }

        .btn-restart {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            transition: transform 0.1s;
            font-family: inherit;
            font-weight: bold;
        }
        .btn-restart:active { transform: scale(0.95); }

        /* Keyframes */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) scale(1.1); }
            20%, 80% { transform: translate3d(2px, 0, 0) scale(1.1); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) scale(1.1); }
            40%, 60% { transform: translate3d(4px, 0, 0) scale(1.1); }
        }
        @keyframes zoomAndGlow {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background-color: #ffeaa7; }
            100% { transform: scale(1); background-color: white; }
        }
        @keyframes explodeAndFade {
            0% { transform: scale(1); opacity: 1; filter: blur(0px); }
            50% { transform: scale(0.8) rotate(10deg); opacity: 0.5; filter: blur(4px); }
            100% { transform: scale(0) rotate(20deg); opacity: 0; filter: blur(10px); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Agent: The Soul of the App -->
    <div id="agent-container">
        <div class="agent-avatar">üë©‚Äçüç≥</div>
        <div class="agent-bubble" id="agent-bubble">
            ÂìéÂî∑ÔºÅÈÄôÂÖ©Ê®£ÁúãËµ∑‰æÜÈÉΩÂæàÂ•ΩÂêÉÊçèÔºÅ
        </div>
    </div>

    <!-- Main Interaction Area -->
    <div id="arena">
        <!-- Left Card -->
        <div class="food-card" id="left-card" onclick="selectWinner('left')" onmouseenter="onHover('left')">
            <div class="card-bg-effect"></div>
            
            <div class="food-image-wrapper">
                <img id="left-image" class="food-image" src="" alt="Food" onerror="handleImageError('left')">
                <div id="left-emoji" class="emoji-fallback"></div>
            </div>
            
            <div class="food-name" id="left-name">ÁâõËÇâÈ∫µ</div>
        </div>

        <!-- Right Card -->
        <div class="food-card" id="right-card" onclick="selectWinner('right')" onmouseenter="onHover('right')">
            <div class="card-bg-effect"></div>
            
            <div class="food-image-wrapper">
                <img id="right-image" class="food-image" src="" alt="Food" onerror="handleImageError('right')">
                <div id="right-emoji" class="emoji-fallback"></div>
            </div>

            <div class="food-name" id="right-name">ÁèçÁè†Â•∂Ëå∂</div>
        </div>
    </div>

    <!-- Champion Display -->
    <div id="champion-screen">
        <h1 class="champion-title">üèÜ Âè∞ÁÅ£ÁæéÈ£üÂÜ†Ëªç üèÜ</h1>
        
        <div class="champion-image-wrapper">
            <img id="champion-image" src="" alt="Champion" onerror="handleChampionImageError()">
            <div id="champion-emoji" class="emoji-fallback big"></div>
        </div>
        
        <h2 class="champion-name" id="champion-name"></h2>
        <button class="btn-restart" onclick="restartGame()">ÂÜçÁé©‰∏ÄÊ¨° (ËÇöÂ≠êÈ§ì‰∫Ü)</button>
    </div>

    <!-- Progress & Context -->
    <div id="progress-container">
        <div id="round-info">32 Âº∑Ë≥Ω</div>
        <div class="progress-dots" id="dots-container"></div>
    </div>

    <script>
        // Data: 32 Taiwanese Foods
        const allFoods = [
            { name: "Êª∑ËÇâÈ£Ø", enName: "Braised Pork Rice", emoji: "üçö", desc: "ËÇ•Áò¶Áõ∏ÈñìÔºåÂÖ•Âè£Âç≥ÂåñÔºÅ" },
            { name: "ÁèçÁè†Â•∂Ëå∂", enName: "Bubble Tea", emoji: "üßã", desc: "Âè∞ÁÅ£‰πãÂÖâÔºåQÂΩàÊúâÂãÅÔºÅ" },
            { name: "Ëá≠Ë±ÜËÖê", enName: "Stinky Tofu", emoji: "üò§", desc: "Ë∂äËá≠Ë∂äÈ¶ôÔºåÂ§ñÈÖ•ÂÖßÂ´©ÔºÅ" },
            { name: "ÈõûÊéí", enName: "Fried Chicken Fillet", emoji: "üçó", desc: "ÊØîËáâÈÇÑÂ§ßÔºåÁΩ™ÊÉ°ÊÑüÊªøÊªøÔºÅ" },
            { name: "ÁâõËÇâÈ∫µ", enName: "Beef Noodle Soup", emoji: "üçú", desc: "ÊπØÈ†≠ÊøÉÈÉÅÔºåËÇâÂ°äÂéöÂØ¶ÔºÅ" },
            { name: "Â∞èÁ±†ÂåÖ", enName: "Xiao Long Bao", emoji: "ü•ü", desc: "ÁöÆËñÑÈ§°Â§öÔºåÂ∞èÂøÉÁáôÂè£ÔºÅ" },
            { name: "Ëöµ‰ªîÁÖé", enName: "Oyster Omelet", emoji: "ü¶™", desc: "ÈÆÆÁîúËÇ•ÁæéÔºåÈÜ¨Ê±ÅÊòØÈùàÈ≠ÇÔºÅ" },
            { name: "ËäíÊûúÂÜ∞", enName: "Mango Shaved Ice", emoji: "ü•≠", desc: "Â§èÊó•ÂøÖÂÇôÔºåÈÖ∏ÁîúÊ∂àÊöëÔºÅ" },
            { name: "Â§ßËÖ∏ÂåÖÂ∞èËÖ∏", enName: "Taiwanese Sausage", emoji: "üå≠", desc: "Âè∞ÂºèÁÜ±ÁãóÔºåÁÇ≠ÁÅ´È¶ôÊ∞£ÔºÅ" },
            { name: "Ëî•ÊäìÈ§Ö", enName: "Scallion Pancake", emoji: "ü•û", desc: "Â±§Ê¨°ÂàÜÊòéÔºåÈÖ•ËÑÜÊéâÊ∏£ÔºÅ" },
            { name: "Êª∑Âë≥", enName: "Braised Dishes", emoji: "ü•ö", desc: "ÂÆµÂ§úÈ¶ñÈÅ∏ÔºåÊ®£Ê®£ÂÖ•Âë≥ÔºÅ" },
            { name: "ÈπΩÈÖ•Èõû", enName: "Popcorn Chicken", emoji: "üçñ", desc: "‰πùÂ±§Â°îÈ¶ôÔºå‰∏ÄÂè£Êé•‰∏ÄÂè£ÔºÅ" },
            { name: "È≥≥Ê¢®ÈÖ•", enName: "Pineapple Cake", emoji: "üçç", desc: "ÈáëÈªÉÂÖßÈ§°Ôºå‰º¥ÊâãÁ¶Æ‰πãÁéãÔºÅ" },
            { name: "Ë±ÜËä±", enName: "Tofu Pudding", emoji: "üçÆ", desc: "Á∂øÂØÜÊªëÈ†ÜÔºåËä±ÁîüËªüÁàõÔºÅ" },
            { name: "Ë±¨Ë°ÄÁ≥ï", enName: "Pig Blood Cake", emoji: "üç¢", desc: "Âè£ÊÑüQÁ≥ØÔºåÊ≤æËä±ÁîüÁ≤âÁµïÈÖçÔºÅ" },
            { name: "ÂààÂåÖ", enName: "Gua Bao", emoji: "üçî", desc: "Âè∞ÂºèÊº¢Â†°ÔºåËÇ•ËÇâÂä†Ëä±ÁîüÁ≤âÔºÅ" },
            { name: "Âú∞ÁìúÁêÉ", enName: "Sweet Potato Balls", emoji: "üç†", desc: "Â§ñÈÖ•ÂÖßÁ©∫ÔºåÂ§úÂ∏ÇÂøÖË≤∑ÔºÅ" },
            { name: "ÊΩ§È§Ö", enName: "Popiah", emoji: "üåØ", desc: "Ê∏ÖÁàΩË±êÂØåÔºå‰∏ÄÊç≤ÊªøË∂≥ÔºÅ" },
            { name: "Êìî‰ªîÈ∫µ", enName: "Danzai Noodles", emoji: "üçú", desc: "ËÇâÁá•Ëù¶ÊπØÔºåÁôæÂπ¥ÊªãÂë≥ÔºÅ" },
            { name: "Á¢óÁ≤ø", enName: "Salty Rice Pudding", emoji: "ü•£", desc: "Á±≥È¶ôÊøÉÈÉÅÔºåÈÜ¨Ê≤πËÜèÈππÁîúÔºÅ" },
            { name: "ÈêµËõã", enName: "Iron Egg", emoji: "üåë", desc: "Ë∂äÂöºË∂äÈ¶ôÔºåÊ∑°Ê∞¥ÂêçÁî¢ÔºÅ" },
            { name: "Â§™ÈôΩÈ§Ö", enName: "Sun Cake", emoji: "‚òÄÔ∏è", desc: "ÈÖ•ÁöÆÈ∫•ËäΩÔºåÂè∞‰∏≠È©ïÂÇ≤ÔºÅ" },
            { name: "Ê£∫ÊùêÊùø", enName: "Coffin Bread", emoji: "üçû", desc: "ÁÇ∏ÂêêÂè∏Ë£ùÊøÉÊπØÔºåÂè£ÊÑüË±êÂØåÔºÅ" },
            { name: "ËÇâÂúì", enName: "Ba Wan", emoji: "üçò", desc: "QÁöÆËÇâÈ§°ÔºåÁÇ∏Ëí∏ÁöÜÂÆúÔºÅ" },
            { name: "ËñëÊØçÈ¥®", enName: "Ginger Duck", emoji: "ü•ò", desc: "ÂÜ¨Êó•ÈÄ≤Ë£úÔºåÂÖ®Ë∫´ÊöñÂëºÂëºÔºÅ" },
            { name: "ÁæäËÇâÁàê", enName: "Mutton Hot Pot", emoji: "üç≤", desc: "Ëó•ËÜ≥ÊπØÈ†≠ÔºåÊ∫´ÊΩ§ÊªãË£úÔºÅ" },
            { name: "ÂââÂÜ∞", enName: "Shaved Ice", emoji: "üçß", desc: "ÈÖçÊñôËá™ÈÅ∏ÔºåÊ∑ã‰∏äÈªëÁ≥ñÊ∞¥ÔºÅ" },
            { name: "Êú®ÁìúÁâõÂ•∂", enName: "Papaya Milk", emoji: "ü•õ", desc: "ÊøÉÈÜáÈ¶ôÊªëÔºåÂÆåÁæéÊØî‰æãÔºÅ" },
            { name: "ÈõûËÇâÈ£Ø", enName: "Turkey Rice", emoji: "üçö", desc: "ÈõûÊ≤πÊãåÈ£ØÔºåÁ∞°ÂñÆÁæéÂë≥ÔºÅ" },
            { name: "ËÉ°Ê§íÈ§Ö", enName: "Pepper Bun", emoji: "ü•Ø", desc: "ÁÇ≠ÁÉ§ÁÑ¶È¶ôÔºåËÇâÊ±ÅÁàÜÁôºÔºÅ" },
            { name: "ËõãÈ§Ö", enName: "Egg Pancake Roll", emoji: "üç≥", desc: "Êó©È§êÁ∂ìÂÖ∏ÔºåÂè£Âë≥ÁôæËÆäÔºÅ" },
            { name: "È∫µÁ∑ö", enName: "Oyster Vermicelli", emoji: "üçú", desc: "Â§ßËÖ∏Ëöµ‰ªîÔºåÂãæËä°ÊªëÈ†ÜÔºÅ" }
        ];

        const auntieQuotes = {
            start: ["‰æÜ‰æÜ‰æÜÔºÅÈÄôÂÖ©Ê®£‰Ω†ÈÅ∏Âì™‰∏ÄÊ®£ÔºüÈòøÂß®Ë´ãÂÆ¢...ÊâçÊÄ™ÔºÅ", "ÂìéÂî∑ÔºÅÈÄôÂÖ©ÂÄãÈÉΩÂæàÂé≤ÂÆ≥ÊçèÔºÅ", "ÈÅ∏‰∏çÂá∫‰æÜÂóéÔºüÈñâËëóÁúºÁùõÊåâ‰∏ãÂéªÂï¶ÔºÅ"],
            hover: ["ÈÄôÂÄãÂ•ΩÔºÅÈÄôÂÄãÁúüÁöÑÂ•ΩÔºÅ", "ÈÅ∏ÊàëÔºÅÊàëË∂ÖÂ§öÊ±ÅÁöÑÔºÅ", "‰Ω†ÁúãÈÇ£ÂÄãÁöÆÔºåÂòñÂòñÂòñÔºÅ", "ÈòøÂß®Ë∑ü‰Ω†Ë™™ÔºåÈÄôÂÄãÊòØÊãõÁâåÔºÅ"],
            click: ["Â•ΩÁúºÂÖâÔºÅÈòøÂß®‰πüÂñúÊ≠°ÈÄôÂÄãÔºÅ", "ÁúüÁöÑÂÅáÁöÑÔºü‰Ω†Á´üÁÑ∂ÈÅ∏ÈÄôÂÄãÔºÅ", "Ê≤íÈåØÔºÅÈÄôÂÄãÊâçÊòØÁéãÈÅìÔºÅ"]
        };

        // State Variables
        let currentRoundCandidates = [];
        let nextRoundCandidates = [];
        let currentPairIndex = 0;
        let roundName = "32 Âº∑Ë≥Ω";
        let isAnimating = false;
        let champion = null;
        let audioCtx = null;

        // Image URL Helper (Bing Thumbnail)
        function getImageUrl(food) {
            const query = `${food.name} Âè∞ÁÅ£ÁæéÈ£ü`;
            return `https://tse2.mm.bing.net/th?q=${encodeURIComponent(query)}&w=500&h=500&c=7&rs=1`;
        }

        // Handle Image Errors (Fallback to Emoji)
        function handleImageError(side) {
            console.log(`Image failed for ${side}`);
            document.getElementById(`${side}-image`).style.display = 'none';
            document.getElementById(`${side}-emoji`).style.display = 'block';
        }

        function handleChampionImageError() {
            document.getElementById('champion-image').style.display = 'none';
            document.getElementById('champion-emoji').style.display = 'block';
        }

        function initGame() {
            // Shuffle
            currentRoundCandidates = [...allFoods].sort(() => Math.random() - 0.5).slice(0, 32);
            nextRoundCandidates = [];
            currentPairIndex = 0;
            roundName = "32 Âº∑Ë≥Ω";
            champion = null;
            isAnimating = false;

            // UI Reset
            document.getElementById('champion-screen').style.display = 'none';
            document.getElementById('arena').style.display = 'flex';
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('agent-container').style.display = 'block';

            updateAgent(getRandomQuote(auntieQuotes.start));
            renderPair();
        }

        function renderPair() {
            if (champion) return;

            const item1 = currentRoundCandidates[currentPairIndex];
            const item2 = currentRoundCandidates[currentPairIndex + 1];

            // Reset Cards Styles
            document.getElementById('left-card').className = 'food-card';
            document.getElementById('right-card').className = 'food-card';

            // Left
            const leftImg = document.getElementById('left-image');
            const leftEmoji = document.getElementById('left-emoji');
            
            // Reset to show image first, hide emoji
            leftImg.style.display = 'block';
            leftEmoji.style.display = 'none';
            leftEmoji.innerText = item1.emoji;
            // Set Src triggers load
            leftImg.src = getImageUrl(item1);
            
            document.getElementById('left-name').innerText = item1.name;

            // Right
            const rightImg = document.getElementById('right-image');
            const rightEmoji = document.getElementById('right-emoji');
            
            rightImg.style.display = 'block';
            rightEmoji.style.display = 'none';
            rightEmoji.innerText = item2.emoji;
            rightImg.src = getImageUrl(item2);

            document.getElementById('right-name').innerText = item2.name;

            // Progress
            document.getElementById('round-info').innerText = roundName;
            updateDots();
        }

        function updateDots() {
            const container = document.getElementById('dots-container');
            container.innerHTML = '';
            const totalPairs = Math.ceil(currentRoundCandidates.length / 2);
            const currentPair = Math.floor(currentPairIndex / 2);

            for (let i = 0; i < totalPairs; i++) {
                const dot = document.createElement('div');
                dot.className = `dot ${i <= currentPair ? 'active' : ''}`;
                container.appendChild(dot);
            }
        }

        function selectWinner(side) {
            if (isAnimating) return;
            isAnimating = true;
            playSound('select');

            // Agent feedback
            updateAgent(getRandomQuote(auntieQuotes.click));

            // Logic
            const winnerItem = side === 'left' ? currentRoundCandidates[currentPairIndex] : currentRoundCandidates[currentPairIndex + 1];
            nextRoundCandidates.push(winnerItem);

            // Animation classes
            const winnerCard = document.getElementById(`${side}-card`);
            const loserCard = document.getElementById(side === 'left' ? 'right-card' : 'left-card');

            winnerCard.classList.add('winner-anim');
            loserCard.classList.add('loser-anim');

            setTimeout(() => {
                advancePair();
            }, 800);
        }

        function advancePair() {
            isAnimating = false;
            currentPairIndex += 2;

            if (currentPairIndex >= currentRoundCandidates.length) {
                advanceRound();
            } else {
                renderPair();
            }
        }

        function advanceRound() {
            if (nextRoundCandidates.length === 1) {
                showChampion(nextRoundCandidates[0]);
                return;
            }

            currentRoundCandidates = [...nextRoundCandidates];
            nextRoundCandidates = [];
            currentPairIndex = 0;

            const count = currentRoundCandidates.length;
            if (count === 16) roundName = "16 Âº∑ÊøÄÊà∞";
            else if (count === 8) roundName = "8 Âº∑Áà≠Èú∏";
            else if (count === 4) roundName = "4 Âº∑Ê∫ñÊ±∫Ë≥Ω";
            else if (count === 2) roundName = "ÂÜ†‰∫ûËªçÊ±∫Ë≥Ω";

            updateAgent(`ÊÅ≠ÂñúÈÄ≤ÂÖ• ${roundName}ÔºÅË∂ä‰æÜË∂äÈõ£ÈÅ∏‰∫ÜÂ∞çÂêßÔºü`);
            renderPair();
        }

        function showChampion(item) {
            champion = item;
            document.getElementById('arena').style.display = 'none';
            document.getElementById('progress-container').style.display = 'none';
            // Agent can stay or go, let's keep her hidden to focus on champion
            document.getElementById('agent-container').style.display = 'none';

            const screen = document.getElementById('champion-screen');
            screen.style.display = 'flex';
            
            document.getElementById('champion-name').innerText = item.name;
            
            // Champion Image
            const img = document.getElementById('champion-image');
            const emoji = document.getElementById('champion-emoji');
            
            img.style.display = 'block';
            emoji.style.display = 'none';
            emoji.innerText = item.emoji;
            img.src = getImageUrl(item);
        }

        function restartGame() {
            initGame();
        }

        function onHover(side) {
            if (isAnimating) return;
            playSound('hover');
            
            const item = side === 'left' ? currentRoundCandidates[currentPairIndex] : currentRoundCandidates[currentPairIndex + 1];
            updateAgent(`${item.desc} ${getRandomQuote(auntieQuotes.hover)}`);
        }

        function updateAgent(text) {
            const bubble = document.getElementById('agent-bubble');
            bubble.classList.add('pop');
            setTimeout(() => bubble.classList.remove('pop'), 200);
            bubble.innerText = text;
        }

        function getRandomQuote(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // Audio Logic
        function playSound(type) {
            try {
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }

                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                const now = audioCtx.currentTime;

                if (type === 'hover') {
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(400, now);
                    oscillator.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                    gainNode.gain.setValueAtTime(0.05, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    oscillator.start(now);
                    oscillator.stop(now + 0.1);
                } else if (type === 'select') {
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(300, now);
                    oscillator.frequency.exponentialRampToValueAtTime(800, now + 0.3);
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                    oscillator.start(now);
                    oscillator.stop(now + 0.3);
                }
            } catch (e) {
                console.warn('Audio play failed', e);
            }
        }

        // Start Game
        initGame();

    </script>
</body>
</html>
