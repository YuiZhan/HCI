<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒé€šæ•¸ä½æ‚ éŠå¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨æ›´ç©©å®šçš„ UMD ç‰ˆæœ¬é€£çµ -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
        .perspective-1000 {
            perspective: 1000px;
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* è‡ªå®šç¾©å‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes popUp {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 0.2s ease-out forwards;
        }
        .animate-zoom-in {
            animation: zoomIn 0.3s ease-out forwards;
        }
        .animate-pop-up {
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4 font-sans text-slate-800 select-none">

    <!-- é ‚éƒ¨å°èˆª -->
    <div class="w-full max-w-md bg-white rounded-2xl shadow-sm p-4 mb-6 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="bg-blue-100 p-2 rounded-full text-blue-600">
                <i data-lucide="globe" class="w-5 h-5"></i>
            </div>
            <div>
                <p class="text-xs text-gray-500">ç›®å‰ä½ç½®</p>
                <h2 id="current-location-display" class="font-bold text-gray-800 flex items-center gap-1">
                    <!-- Javascript will populate this -->
                </h2>
            </div>
        </div>
        <div class="text-right">
            <p class="text-xs text-gray-500">å³æ™‚åŒ¯ç‡</p>
            <p id="exchange-rate-display" class="font-mono text-sm font-medium text-gray-600">
                <!-- Javascript will populate this -->
            </p>
        </div>
    </div>

    <!-- æ•¸ä½å¡ç‰‡å€ -->
    <div id="card-container" class="relative w-full max-w-md aspect-[1.586/1] mb-8 perspective-1000 group cursor-pointer">
        <div id="card-inner" class="absolute inset-0 rounded-2xl shadow-xl transition-all duration-500 transform hover:scale-105 overflow-hidden bg-gradient-to-br from-slate-900 to-slate-700">
            
            <!-- å¡ç‰‡èƒŒæ™¯è£é£¾ -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-green-400 rounded-full mix-blend-overlay filter blur-3xl opacity-20 translate-x-10 -translate-y-10"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-500 rounded-full mix-blend-overlay filter blur-3xl opacity-20 -translate-x-10 translate-y-10"></div>
            
            <!-- å¡ç‰‡å…§å®¹ -->
            <div class="relative z-10 p-6 flex flex-col justify-between h-full text-white">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30">
                            <div class="w-4 h-4 rounded-full bg-gradient-to-tr from-green-300 to-blue-300"></div>
                        </div>
                        <span class="font-bold tracking-wider opacity-90">EasyCard Global</span>
                    </div>
                    <div class="bg-white/10 backdrop-blur-md px-3 py-1 rounded-full text-xs border border-white/20">
                        Contactless
                    </div>
                </div>

                <div class="space-y-1">
                    <p class="text-xs text-gray-300 font-medium">å¯ç”¨é¤˜é¡ (TWD)</p>
                    <h1 id="balance-display" class="text-3xl font-mono font-bold tracking-tight">
                        $5,000
                    </h1>
                </div>

                <div class="flex justify-between items-end">
                    <p class="font-mono text-sm opacity-60">8888 1234 5678 9000</p>
                    <div id="processing-indicator" class="hidden flex items-center gap-2 bg-white/20 backdrop-blur-md px-3 py-1 rounded-full text-xs animate-pulse">
                         <i data-lucide="scan-line" class="w-3 h-3"></i>
                         <span>æ­£åœ¨è®€å–å•†å®¶...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ„Ÿæ‡‰æç¤º -->
        <div id="tap-hint" class="absolute -bottom-8 left-0 right-0 text-center text-sm text-gray-400 animate-bounce transition-opacity duration-300">
            é»æ“Šå¡ç‰‡æ„Ÿæ‡‰æ”¯ä»˜ (Tap to Pay)
        </div>
    </div>

    <!-- åœ‹å®¶åˆ‡æ›å™¨ -->
    <div class="w-full max-w-md">
        <p class="text-sm text-gray-500 mb-3 ml-1 font-medium">åˆ‡æ›åœ‹å®¶æ¨¡æ“¬æ¶ˆè²»</p>
        <div id="country-list" class="flex gap-3 overflow-x-auto pb-4 no-scrollbar touch-pan-x">
            <!-- JS will populate buttons here -->
        </div>
    </div>

    <!-- åº•éƒ¨æ“ä½œå€ -->
    <div class="mt-auto w-full max-w-md grid grid-cols-2 gap-4">
        <button id="reset-btn" class="flex items-center justify-center gap-2 bg-white p-4 rounded-2xl text-gray-600 hover:bg-gray-50 transition border border-gray-100 shadow-sm active:scale-95">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
            é‡ç½®é¤˜é¡
        </button>
        <div class="flex items-center justify-center gap-2 bg-white p-4 rounded-2xl text-gray-600 border border-gray-100 shadow-sm opacity-60 cursor-not-allowed">
            <i data-lucide="wallet" class="w-4 h-4"></i>
            åŠ å€¼ç´€éŒ„
        </div>
    </div>

    <!-- æ”¯ä»˜æˆåŠŸ Modal -->
    <div id="feedback-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-fade-in">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl transform animate-zoom-in relative overflow-hidden">
            
            <!-- èƒŒæ™¯æ°›åœå…‰ (å‹•æ…‹æ”¹è®Šé¡è‰²) -->
            <div id="modal-bg-gradient" class="absolute top-0 left-0 right-0 h-48 bg-gradient-to-b opacity-15"></div>
            
            <div class="relative z-10 flex flex-col items-center text-center">
                <!-- æˆåŠŸå‹•ç•«åœ–ç¤º -->
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-500 mb-2 shadow-sm ring-4 ring-white animate-bounce">
                    <i data-lucide="check" class="w-6 h-6"></i>
                </div>
                
                <h2 class="text-xl font-bold text-gray-800 mb-1">æ”¯ä»˜æˆåŠŸï¼</h2>
                <p id="modal-greeting" class="text-sm text-gray-500 mb-6">ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼</p>
                
                <!-- æ–°å¢ï¼šé†’ç›®çš„æ¶ˆè²»é …ç›®å±•ç¤ºå€ -->
                <div class="w-full mb-6 animate-pop-up">
                    <div class="flex flex-col items-center justify-center p-5 bg-gradient-to-b from-white to-gray-50 rounded-2xl border border-blue-100 shadow-sm">
                        <div id="prominent-icon-container" class="text-blue-600 mb-2 transform scale-125">
                            <!-- Large JS Icon here -->
                        </div>
                        <p class="text-xs text-gray-400 font-medium tracking-wide mb-1">æ‚¨å‰›å‰›åœ¨</p>
                        <h3 id="prominent-label" class="text-2xl font-bold text-gray-900 tracking-tight">
                            <!-- Large Item Name -->
                        </h3>
                    </div>
                </div>

                <!-- äº¤æ˜“è©³æƒ…å¡ -->
                <div class="w-full bg-gray-50 rounded-2xl p-4 mb-6 border border-gray-100">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-gray-500 text-sm">ç•¶åœ°é‡‘é¡</span>
                        <span id="transaction-local-amount" class="text-xl font-bold text-gray-800 font-mono">
                            $0
                        </span>
                    </div>
                    
                    <div class="flex justify-between items-center pt-2 border-t border-gray-200">
                        <span class="text-gray-500 text-sm flex items-center gap-1">
                            <img src="https://flagcdn.com/w20/tw.png" alt="TW" class="w-4 rounded-sm shadow-sm" />
                            å°å¹£æ‰£æ¬¾
                        </span>
                        <span id="transaction-twd-amount" class="text-lg font-bold text-blue-600 font-mono bg-blue-50 px-2 py-1 rounded-lg">
                            -NT$0
                        </span>
                    </div>
                    <div class="text-right mt-1">
                        <span id="transaction-time" class="text-[10px] text-gray-400">
                            <!-- Time -->
                        </span>
                    </div>
                </div>

                <button id="close-modal-btn" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold hover:bg-gray-800 transition active:scale-95 shadow-lg shadow-gray-200">
                    å®Œæˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™è¨­å®š
        const COUNTRIES = [
            { id: 'TW', name: 'å°ç£', currency: 'TWD', rate: 1, icon: 'ğŸ‡¹ğŸ‡¼', greeting: 'ç¥æ‚¨æœ‰ç¾å¥½çš„ä¸€å¤©ï¼', theme: 'from-green-400 to-blue-500' },
            { id: 'JP', name: 'æ—¥æœ¬', currency: 'JPY', rate: 0.21, icon: 'ğŸ‡¯ğŸ‡µ', greeting: 'æ—…é€”æ„‰å¿«ï¼æ¥½ã—ã‚“ã§ï¼', theme: 'from-red-400 to-pink-500' },
            { id: 'US', name: 'ç¾åœ‹', currency: 'USD', rate: 31.5, icon: 'ğŸ‡ºğŸ‡¸', greeting: 'Have a nice trip!', theme: 'from-blue-600 to-red-500' },
            { id: 'KR', name: 'éŸ“åœ‹', currency: 'KRW', rate: 0.024, icon: 'ğŸ‡°ğŸ‡·', greeting: 'ç¥æ‚¨è³¼ç‰©æ„‰å¿«ï¼', theme: 'from-blue-400 to-red-400' },
            { id: 'EU', name: 'æ­æ´²', currency: 'EUR', rate: 34.2, icon: 'ğŸ‡ªğŸ‡º', greeting: 'äº«å—æµªæ¼«æ™‚å…‰ï¼', theme: 'from-blue-500 to-yellow-400' },
        ];

        const SCENARIOS = [
            { type: 'transport', label: 'åœ°éµæ­ä¹˜', iconName: 'train-front', baseTwd: 45 },
            { type: 'food', label: 'ä¾¿åˆ©å•†åº—', iconName: 'coffee', baseTwd: 120 },
            { type: 'shopping', label: 'ä¼´æ‰‹ç¦®åº—', iconName: 'shopping-bag', baseTwd: 850 },
            { type: 'dining', label: 'ç‰¹è‰²é¤å»³', iconName: 'utensils', baseTwd: 450 },
            { type: 'entertainment', label: 'éŠæ¨‚åœ’é–€ç¥¨', iconName: 'ticket', baseTwd: 1200 },
            { type: 'taxi', label: 'è¨ˆç¨‹è»Š', iconName: 'car-taxi-front', baseTwd: 300 }
        ];

        // ç‹€æ…‹è®Šæ•¸
        let state = {
            currentCountry: COUNTRIES[0],
            balance: 5000,
            isProcessing: false
        };

        // DOM å…ƒç´ å¼•ç”¨
        const els = {
            locationDisplay: document.getElementById('current-location-display'),
            exchangeRateDisplay: document.getElementById('exchange-rate-display'),
            balanceDisplay: document.getElementById('balance-display'),
            cardContainer: document.getElementById('card-container'),
            cardInner: document.getElementById('card-inner'),
            processingIndicator: document.getElementById('processing-indicator'),
            tapHint: document.getElementById('tap-hint'),
            countryList: document.getElementById('country-list'),
            modal: document.getElementById('feedback-modal'),
            modalBg: document.getElementById('modal-bg-gradient'),
            modalGreeting: document.getElementById('modal-greeting'),
            prominentIconContainer: document.getElementById('prominent-icon-container'),
            prominentLabel: document.getElementById('prominent-label'),
            transTime: document.getElementById('transaction-time'),
            transLocalAmount: document.getElementById('transaction-local-amount'),
            transTwdAmount: document.getElementById('transaction-twd-amount'),
            closeModalBtn: document.getElementById('close-modal-btn'),
            resetBtn: document.getElementById('reset-btn')
        };

        // åˆå§‹åŒ–
        function init() {
            renderCountryList();
            updateDashboard();
            if (window.lucide) {
                lucide.createIcons(); 
            }
            
            // ç¶å®šäº‹ä»¶
            els.cardContainer.addEventListener('click', handlePayment);
            els.closeModalBtn.addEventListener('click', closeModal);
            els.resetBtn.addEventListener('click', resetBalance);
        }

        // æ¸²æŸ“åœ‹å®¶åˆ—è¡¨æŒ‰éˆ•
        function renderCountryList() {
            els.countryList.innerHTML = COUNTRIES.map(country => `
                <button 
                    onclick="changeCountry('${country.id}')"
                    class="country-btn flex-shrink-0 flex items-center gap-2 px-4 py-3 rounded-xl border transition-all duration-200 ${
                        state.currentCountry.id === country.id
                        ? 'bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-200'
                        : 'bg-white text-gray-600 border-gray-200 hover:border-blue-300'
                    }"
                    id="btn-${country.id}"
                >
                    <span class="text-xl">${country.icon}</span>
                    <span class="font-medium">${country.name}</span>
                </button>
            `).join('');
        }

        // åˆ‡æ›åœ‹å®¶
        window.changeCountry = (id) => {
            if (state.isProcessing) return;
            state.currentCountry = COUNTRIES.find(c => c.id === id);
            renderCountryList();
            updateDashboard();
        };

        // æ›´æ–°ä»‹é¢è³‡è¨Š
        function updateDashboard() {
            const { currentCountry, balance } = state;
            
            els.locationDisplay.innerHTML = `${currentCountry.icon} ${currentCountry.name}`;
            const rateDisplay = currentCountry.rate < 1 ? currentCountry.rate.toFixed(3) : currentCountry.rate.toFixed(1);
            els.exchangeRateDisplay.textContent = `1 ${currentCountry.currency} â‰ˆ ${rateDisplay} TWD`;
            els.balanceDisplay.textContent = `$${balance.toLocaleString()}`;
        }

        // è™•ç†æ”¯ä»˜æ¨¡æ“¬
        function handlePayment() {
            if (state.isProcessing) return;
            
            startProcessing();

            // éš¨æ©Ÿé¸æ“‡å ´æ™¯
            const scenario = SCENARIOS[Math.floor(Math.random() * SCENARIOS.length)];

            // è¨ˆç®—é‡‘é¡
            const randomFactor = 0.8 + Math.random() * 0.4;
            const twdAmount = Math.round(scenario.baseTwd * randomFactor);
            const localAmount = twdAmount / state.currentCountry.rate;

            // æ¨¡æ“¬å»¶é²
            setTimeout(() => {
                state.balance -= twdAmount;
                stopProcessing();
                updateDashboard();
                showFeedback({
                    ...scenario,
                    twdAmount,
                    localAmount,
                    country: state.currentCountry
                });
            }, 1200);
        }

        function startProcessing() {
            state.isProcessing = true;
            els.cardInner.classList.add('scale-95', 'brightness-90');
            els.cardInner.classList.remove('hover:scale-105');
            els.processingIndicator.classList.remove('hidden'); // é¡¯ç¤ºè®€å–ä¸­æ–‡å­—
            els.tapHint.classList.add('opacity-0');
            if (window.lucide) lucide.createIcons(); // ç¢ºä¿æ–°é¡¯ç¤ºçš„ icon è¢«æ¸²æŸ“
        }

        function stopProcessing() {
            state.isProcessing = false;
            els.cardInner.classList.remove('scale-95', 'brightness-90');
            els.cardInner.classList.add('hover:scale-105');
            els.processingIndicator.classList.add('hidden');
            els.tapHint.classList.remove('opacity-0');
        }

        // æ ¼å¼åŒ–è²¨å¹£
        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 2,
            }).format(amount);
        }

        // é¡¯ç¤º Feedback Modal
        function showFeedback(transaction) {
            // èƒŒæ™¯
            els.modalBg.className = `absolute top-0 left-0 right-0 h-48 bg-gradient-to-b ${transaction.country.theme} opacity-15`;
            
            // å•å€™èª
            els.modalGreeting.textContent = transaction.country.greeting;

            // ***** é‡è¦ä¿®æ­£ï¼šå„ªå…ˆè¨­å®šæ–‡å­—ï¼Œé¿å… JS éŒ¯èª¤å°è‡´æ–‡å­—æ¶ˆå¤± *****
            if (transaction.label) {
                els.prominentLabel.textContent = transaction.label;
                console.log("Updated label to:", transaction.label);
            } else {
                els.prominentLabel.textContent = "ä¸€èˆ¬æ¶ˆè²»";
            }
            
            // åœ–ç¤ºè™•ç† (åŒ…å«éŒ¯èª¤æ•æ‰)
            try {
                // æª¢æŸ¥ Lucide æ˜¯å¦å­˜åœ¨
                if (typeof lucide !== 'undefined' && lucide.icons) {
                    const iconKey = kebabToCamel(transaction.iconName);
                    // å‚™æ¡ˆï¼šå¦‚æœæ‰¾ä¸åˆ°å°æ‡‰åœ–ç¤ºï¼Œä½¿ç”¨ ShoppingBag
                    const IconClass = lucide.icons[iconKey] || lucide.icons.ShoppingBag;
                    
                    if (IconClass) {
                        const iconSvg = IconClass.toSvg({ class: "w-12 h-12 stroke-[1.5]" });
                        els.prominentIconContainer.innerHTML = iconSvg;
                    } else {
                        throw new Error("Icon class not found");
                    }
                } else {
                    throw new Error("Lucide library not loaded");
                }
            } catch (e) {
                console.warn("Icon render failed, using fallback emoji:", e);
                // è¬ä¸€åœ–ç¤ºæ›äº†ï¼Œä½¿ç”¨ Emoji ç¢ºä¿ç•«é¢æœ‰æ±è¥¿
                els.prominentIconContainer.innerHTML = '<span class="text-5xl">ğŸ›ï¸</span>';
            }
            
            // æ™‚é–“èˆ‡é‡‘é¡
            els.transTime.textContent = new Date().toLocaleString();
            els.transLocalAmount.textContent = formatCurrency(transaction.localAmount, transaction.country.currency);
            els.transTwdAmount.textContent = `-NT$${Math.abs(transaction.twdAmount)}`;

            // é¡¯ç¤º Modal
            els.modal.classList.remove('hidden');
        }

        function closeModal() {
            els.modal.classList.add('hidden');
        }

        function resetBalance() {
            state.balance = 5000;
            updateDashboard();
            const btn = els.resetBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> å·²é‡ç½®`;
            if (window.lucide) lucide.createIcons();
            setTimeout(() => {
                btn.innerHTML = originalText;
                if (window.lucide) lucide.createIcons();
            }, 1000);
        }

        // Helper: kebab-case -> PascalCase
        function kebabToCamel(s) {
            return s.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join('');
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>
